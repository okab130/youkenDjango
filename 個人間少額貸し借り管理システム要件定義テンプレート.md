# 個人間少額貸し借り管理システム要件定義テンプレート

## 1. システム概要

### 1.1 目的
本システムは、友人・知人・家族間での少額の金銭の貸し借りを記録・管理し、返済予定の可視化、リマインダー機能、履歴管理を通じて、人間関係のトラブルを未然に防ぐことを目的とする。

### 1.2 適用範囲
- 個人間の金銭貸し借りの記録
- 返済予定の管理
- リマインダー・通知機能
- 貸し借り履歴の可視化
- 簡易的な証明書発行
- グループ間の割り勘・立替精算

### 1.3 対象ユーザー
- 一般ユーザー：個人間で金銭の貸し借りを行う人
- グループ管理者：旅行や飲み会等での立替精算を管理する人

### 1.4 利用シーン
- 友人との飲み会後の立替精算
- 旅行時の立替金の精算
- 少額の個人間ローン
- 家族間の一時的な貸し借り
- サークル・グループでの共同購入の精算

## 2. 業務フロー

### 2.1 貸し借り登録フロー
1. 貸主がシステムにログイン
2. 新規貸し借りを登録（借主、金額、期日、メモ等を入力）
3. 借主に通知が送信される
4. 借主が内容を確認し承認
5. 貸し借りが確定し、双方に記録が残る

### 2.2 返済記録フロー
1. 返済が行われる
2. 貸主または借主が返済を記録（全額または一部返済）
3. 相手方に通知が送信される
4. 相手方が返済を承認
5. 返済額が記録され、残高が更新される
6. 完済の場合、ステータスが「完済」に変更

### 2.3 リマインダーフロー
1. システムが返済期日を定期的にチェック
2. 期日が近づいた場合（例：3日前）、借主に通知
3. 期日当日にも通知
4. 期日を過ぎた場合、督促通知（頻度は設定可能）
5. 貸主にも期日超過の通知

### 2.4 グループ精算フロー
1. グループ管理者が立替精算グループを作成
2. メンバーを招待
3. 立替者が費用を登録（金額、用途、立替者、分担者等）
4. システムが自動的に各自の負担額を計算
5. メンバーに通知
6. メンバーが各自の負担額を確認し承認
7. 精算が完了した項目を記録
8. 最終的な収支を確認

## 3. 機能要件

### 3.1 ユーザー管理機能

#### 3.1.1 ユーザー登録・ログイン
- メールアドレスまたは電話番号での登録
- パスワード設定（8文字以上、英数字混在）
- ソーシャルログイン（Google、LINE等）
- パスワードリセット機能
- 2段階認証（オプション）

#### 3.1.2 プロフィール管理
- 表示名の設定
- プロフィール画像の設定
- 通知設定（メール、プッシュ通知のON/OFF）
- 連絡先情報（メール、電話番号）
- アカウント削除機能

#### 3.1.3 友達管理
- 友達の検索（メールアドレス、電話番号、ユーザー名）
- 友達リクエストの送信・承認・拒否
- 友達リストの表示
- 友達の削除・ブロック

### 3.2 貸し借り管理機能

#### 3.2.1 貸し借り登録
- 貸主・借主の選択（友達リストから選択）
- 金額の入力（数値入力、カンマ区切り表示）
- 返済期日の設定（カレンダーピッカー）
- メモ・備考の入力
- 添付ファイル（領収書等の画像）のアップロード
- カテゴリ設定（飲み会、旅行、貸付等）
- 利息の有無・利率設定（オプション）
- 定期返済の設定（月々の返済額、返済日等）

#### 3.2.2 貸し借り確認・承認
- 貸し借り依頼の通知受信
- 内容の確認（金額、期日、メモ等）
- 承認・拒否・修正依頼
- 承認後の自動記録

#### 3.2.3 貸し借り一覧
- 貸しているお金の一覧
- 借りているお金の一覧
- ステータス別表示（未承認、進行中、完済、期日超過等）
- ソート機能（金額、期日、相手名、日付等）
- フィルター機能（期間、カテゴリ、相手等）
- 検索機能

#### 3.2.4 貸し借り詳細
- 基本情報（金額、期日、相手、日付、メモ等）
- 返済履歴の表示
- 残高の表示
- 添付ファイルの表示
- 編集・削除機能（未承認の場合のみ）
- コメント機能（相手とのやりとり）

### 3.3 返済管理機能

#### 3.3.1 返済記録
- 返済額の入力（全額または一部返済）
- 返済日の設定（デフォルトは当日）
- 返済方法の記録（現金、銀行振込、PayPay等）
- メモの入力
- 領収書等の画像添付

#### 3.3.2 返済確認・承認
- 返済記録の通知受信
- 内容の確認
- 承認・拒否
- 異議申し立て機能

#### 3.3.3 返済履歴
- 返済日時、金額、方法の一覧表示
- 累計返済額の表示
- 残高の表示
- 返済進捗バーの表示

### 3.4 通知・リマインダー機能

#### 3.4.1 通知設定
- 通知方法の選択（プッシュ通知、メール、SMS）
- 通知タイミングの設定（期日の○日前、当日、期日後等）
- 通知の頻度設定（毎日、週1回等）
- 通知のON/OFF切替

#### 3.4.2 自動リマインダー
- 返済期日前の通知（デフォルト：3日前、1日前）
- 返済期日当日の通知
- 返済期日超過の通知（初回：期日翌日、以降：週1回）
- 貸主への期日超過通知

#### 3.4.3 手動リマインダー
- 借主への個別リマインダー送信
- リマインダーメッセージのカスタマイズ
- リマインダー送信履歴の記録

### 3.5 グループ精算機能

#### 3.5.1 グループ作成
- グループ名の設定
- グループの説明・用途の入力
- メンバーの招待（友達リストから選択、メール招待）
- グループ画像の設定
- 精算期限の設定

#### 3.5.2 費用登録
- 立替者の選択
- 金額の入力
- 用途・内容の入力
- 分担方法の設定（均等割り、個別指定、比率指定）
- 分担者の選択（グループメンバーから選択）
- 領収書等の画像添付
- カテゴリ設定（交通費、宿泊費、食事代等）

#### 3.5.3 精算計算
- 各メンバーの負担額の自動計算
- 立替金額と負担額の差額計算
- 最適な精算方法の提案（誰が誰にいくら払うか）
- 精算結果の可視化（チャート、リスト）

#### 3.5.4 精算管理
- 精算状況の一覧表示
- 未精算項目のハイライト
- 精算完了の記録
- 精算履歴の表示
- グループ全体の収支サマリー

### 3.6 レポート・統計機能

#### 3.6.1 個人統計
- 総貸付額・総借入額
- 完済率
- 平均返済期間
- 相手別の貸し借り履歴
- カテゴリ別の統計
- 月別・年別の推移グラフ

#### 3.6.2 レポート出力
- 貸し借り履歴のCSVエクスポート
- 期間指定でのレポート生成
- PDFレポートの生成（確定申告用等）

#### 3.6.3 証明書発行
- 借用書の自動生成（PDF）
- 返済証明書の発行
- 簡易的な契約書テンプレート

### 3.7 セキュリティ・プライバシー機能

#### 3.7.1 データ保護
- データの暗号化保存
- 通信の暗号化（SSL/TLS）
- バックアップの自動実施
- アカウント削除時のデータ完全削除

#### 3.7.2 プライバシー設定
- プロフィールの公開範囲設定
- 貸し借り情報の公開範囲設定
- 検索での表示設定

#### 3.7.3 監査ログ
- 全操作の記録（誰が・いつ・何を）
- ログの閲覧（本人のみ）
- 不正アクセスの検知・通知

### 3.8 ヘルプ・サポート機能

#### 3.8.1 ヘルプセンター
- よくある質問（FAQ）
- 使い方ガイド
- チュートリアル動画
- トラブルシューティング

#### 3.8.2 問い合わせ機能
- 問い合わせフォーム
- 問い合わせ履歴の確認
- 回答の通知

## 4. 非機能要件

### 4.1 性能要件
- ページ表示速度：2秒以内
- 通知の送信遅延：1分以内
- 同時アクセス数：1000ユーザーまで対応
- データベースのレスポンスタイム：500ms以内

### 4.2 可用性要件
- システム稼働率：99%以上
- メンテナンス：月1回、深夜帯に実施（通知あり）
- バックアップ：日次自動バックアップ
- 障害時の復旧時間：24時間以内

### 4.3 セキュリティ要件
- データ暗号化：AES-256
- 通信暗号化：TLS 1.2以上
- パスワードポリシー：8文字以上、英数字混在
- セッションタイムアウト：24時間
- アクセスログの保管：1年間

### 4.4 拡張性要件
- ユーザー数：初期1万名、最大10万名まで拡張可能
- データ保管期間：5年間
- API提供による外部連携対応

### 4.5 保守性要件
- システムログの出力
- エラー通知機能
- リモートメンテナンス対応
- 定期的なバージョンアップ

### 4.6 互換性要件
- 対応ブラウザ：Chrome、Firefox、Edge、Safari（最新版含む過去2バージョン）
- モバイルアプリ：iOS 14以上、Android 10以上
- レスポンシブデザイン対応

### 4.7 ユーザビリティ要件
- 直感的な操作性
- 3クリック以内での主要操作完了
- 多言語対応（日本語、英語）
- アクセシビリティ対応（WCAG 2.1 レベルAA準拠）

## 5. データ要件

### 5.1 主要エンティティ

#### 5.1.1 ユーザー（User）
- ユーザーID（主キー）
- ユーザー名
- 表示名
- メールアドレス（ユニーク）
- 電話番号（ユニーク、NULL可）
- パスワード（ハッシュ化）
- プロフィール画像URL
- 登録日時
- 最終ログイン日時
- アカウントステータス（有効、無効、削除済み）
- 通知設定（JSON形式）

#### 5.1.2 友達関係（Friendship）
- 友達関係ID（主キー）
- ユーザーID1（外部キー）
- ユーザーID2（外部キー）
- ステータス（リクエスト中、承認済み、拒否、ブロック）
- リクエスト日時
- 承認日時

#### 5.1.3 貸し借り（Loan）
- 貸し借りID（主キー）
- 貸主ID（外部キー）
- 借主ID（外部キー）
- 元本金額
- 残高
- 返済期日
- ステータス（未承認、進行中、完済、期日超過、キャンセル）
- カテゴリ（飲み会、旅行、貸付、その他）
- メモ
- 添付ファイルURL
- 利息有無
- 利率（％、NULL可）
- 定期返済設定（JSON形式、NULL可）
- 作成日時
- 承認日時
- 完済日時

#### 5.1.4 返済履歴（Repayment）
- 返済ID（主キー）
- 貸し借りID（外部キー）
- 返済額
- 返済日
- 返済方法（現金、銀行振込、PayPay、その他）
- メモ
- 添付ファイルURL
- ステータス（未承認、承認済み、拒否）
- 記録者ID（外部キー：貸主または借主）
- 記録日時
- 承認日時

#### 5.1.5 グループ（Group）
- グループID（主キー）
- グループ名
- 説明
- グループ画像URL
- 作成者ID（外部キー）
- 精算期限
- ステータス（進行中、完了、アーカイブ）
- 作成日時
- 完了日時

#### 5.1.6 グループメンバー（GroupMember）
- グループメンバーID（主キー）
- グループID（外部キー）
- ユーザーID（外部キー）
- ロール（管理者、メンバー）
- ステータス（招待中、参加中、退出）
- 参加日時

#### 5.1.7 グループ費用（GroupExpense）
- 費用ID（主キー）
- グループID（外部キー）
- 立替者ID（外部キー）
- 金額
- 用途・内容
- カテゴリ（交通費、宿泊費、食事代、その他）
- 分担方法（均等割り、個別指定、比率指定）
- 添付ファイルURL
- 登録日時

#### 5.1.8 グループ費用分担（GroupExpenseShare）
- 分担ID（主キー）
- 費用ID（外部キー）
- 分担者ID（外部キー）
- 負担額
- ステータス（未精算、精算済み）
- 精算日時

#### 5.1.9 通知（Notification）
- 通知ID（主キー）
- ユーザーID（外部キー）
- 通知タイプ（貸し借り依頼、返済記録、リマインダー、友達リクエスト等）
- タイトル
- メッセージ
- 関連ID（貸し借りID、グループID等、NULL可）
- 既読フラグ
- 送信日時

#### 5.1.10 リマインダー履歴（ReminderLog）
- ログID（主キー）
- 貸し借りID（外部キー）
- 送信者ID（外部キー、システムの場合はNULL）
- 受信者ID（外部キー）
- メッセージ
- 送信日時

#### 5.1.11 証明書（Certificate）
- 証明書ID（主キー）
- 貸し借りID（外部キー）
- 証明書タイプ（借用書、返済証明書）
- ファイルURL
- 発行日時

#### 5.1.12 操作ログ（ActivityLog）
- ログID（主キー）
- ユーザーID（外部キー）
- アクション（登録、編集、削除、承認等）
- 対象テーブル（Loan、Repayment、Group等）
- 対象ID
- 変更内容（JSON形式）
- IPアドレス
- ユーザーエージェント
- 実行日時

### 5.2 データ整合性
- 外部キー制約の設定
- NOT NULL制約の適切な設定
- UNIQUE制約の設定（メールアドレス、電話番号）
- CHECK制約の設定（金額は正の値、ステータス値の制限等）
- トリガーによる残高の自動更新

### 5.3 データ保管・バックアップ
- 日次自動バックアップ
- バックアップデータの暗号化
- バックアップの世代管理（30日間）
- アカウント削除時のデータアーカイブ（法令対応）

## 6. 画面要件

### 6.1 画面一覧

#### 6.1.1 ログイン・登録画面
- メールアドレス/パスワード入力
- ソーシャルログインボタン（Google、LINE）
- 新規登録リンク
- パスワードリセットリンク

#### 6.1.2 ダッシュボード（ホーム画面）
- 貸しているお金の合計
- 借りているお金の合計
- 返済期日が近い貸し借りのリスト
- 最近の貸し借り一覧
- 未承認の貸し借り通知
- クイックアクセスボタン（新規登録、友達検索等）

#### 6.1.3 貸し借り一覧画面
- タブ切替（貸している、借りている、すべて）
- リスト表示（相手名、金額、期日、ステータス）
- ソート・フィルター機能
- 検索ボックス
- 新規登録ボタン

#### 6.1.4 貸し借り詳細画面
- 基本情報の表示（相手、金額、期日、残高等）
- 返済履歴の表示
- 返済進捗バー
- 添付ファイルの表示
- コメント欄
- アクションボタン（返済記録、リマインダー送信、編集、削除）

#### 6.1.5 貸し借り登録・編集画面
- 相手の選択（友達リストから選択）
- 貸す/借りるの選択
- 金額入力
- 返済期日の選択（カレンダーピッカー）
- メモ入力
- カテゴリ選択
- 添付ファイルのアップロード
- 利息設定（オプション）
- 保存・キャンセルボタン

#### 6.1.6 返済記録画面
- 貸し借り情報の表示
- 返済額の入力（全額・一部返済の選択）
- 返済日の選択
- 返済方法の選択
- メモ入力
- 領収書等の画像アップロード
- 記録ボタン

#### 6.1.7 友達管理画面
- 友達リストの表示
- 検索ボックス（名前、メールアドレス）
- 友達追加ボタン
- 友達リクエスト一覧
- 各友達との貸し借り履歴へのリンク

#### 6.1.8 グループ一覧画面
- 参加グループのリスト
- グループ名、メンバー数、未精算額の表示
- 新規グループ作成ボタン
- グループの検索・フィルター

#### 6.1.9 グループ詳細画面
- グループ情報（名前、説明、メンバー）
- 費用一覧（立替者、金額、用途、精算状況）
- 各メンバーの収支サマリー
- 精算方法の提案表示
- 費用追加ボタン
- グループ設定ボタン

#### 6.1.10 グループ費用登録画面
- 立替者の選択
- 金額入力
- 用途・内容の入力
- カテゴリ選択
- 分担方法の選択（均等割り、個別指定、比率指定）
- 分担者の選択（メンバーから複数選択）
- 添付ファイルのアップロード
- 保存ボタン

#### 6.1.11 通知一覧画面
- 通知のリスト表示（未読・既読で区別）
- 通知タイプ別のアイコン
- 通知日時の表示
- 通知タップで詳細画面へ遷移
- 一括既読ボタン

#### 6.1.12 統計・レポート画面
- 総貸付額・総借入額の表示
- 完済率の表示
- 相手別の貸し借りグラフ
- カテゴリ別の統計グラフ
- 月別・年別の推移グラフ
- レポートエクスポートボタン

#### 6.1.13 設定画面
- プロフィール編集
- 通知設定
- プライバシー設定
- パスワード変更
- アカウント削除
- ヘルプ・サポートへのリンク
- ログアウトボタン

### 6.2 UI/UX要件
- レスポンシブデザイン（スマートフォンファースト）
- 直感的な操作性（ジェスチャー操作対応）
- ダークモード対応
- アクセシビリティ対応（音声読み上げ、大きい文字）
- 多言語対応（日本語、英語）

## 7. 外部インターフェース

### 7.1 外部サービス連携
- ソーシャルログイン（Google、LINE、Facebook）
- プッシュ通知サービス（Firebase Cloud Messaging、APNs）
- メール送信サービス（SendGrid、AWS SES）
- SMS送信サービス（Twilio、AWS SNS）
- クラウドストレージ（AWS S3、Google Cloud Storage）
- 決済サービス連携（PayPay、LINE Pay等）（オプション）

### 7.2 API
- RESTful API提供
- 貸し借りのCRUD操作
- 返済記録API
- 通知API
- 認証API（JWT）
- Webhook（返済期日通知等）

### 7.3 インポート・エクスポート
- 貸し借り履歴のCSVエクスポート
- 証明書のPDFエクスポート
- データバックアップのエクスポート

## 8. 制約事項

### 8.1 技術的制約
- 最大登録可能な貸し借り件数：ユーザーあたり1000件
- 添付ファイルサイズ：最大10MB
- 対応ファイル形式：JPEG、PNG、PDF
- グループメンバー数：最大50名

### 8.2 業務的制約
- 本システムは個人間の記録管理ツールであり、法的効力を保証するものではない
- 高額な金銭の貸し借りには専門家（弁護士、司法書士）への相談を推奨
- 利息計算は参考値であり、正確な計算は別途確認が必要
- 個人情報保護法への対応必須

### 8.3 運用制約
- メンテナンス時間帯：深夜2時～4時（月1回）
- サポート対応：平日10時～18時（メール対応）
- データ保管期間：5年間（それ以降はアーカイブ）

## 9. 前提条件

### 9.1 ハードウェア前提
- サーバー：クラウド環境（AWS、GCP、Azure等）
- データベース：マネージドデータベースサービス
- ストレージ：クラウドストレージ
- CDN：コンテンツ配信ネットワーク

### 9.2 ソフトウェア前提
- OS：Linux（Ubuntu、CentOS等）
- Webサーバー：Nginx
- データベース：PostgreSQL
- Python：3.9以上
- Django：4.x
- モバイルアプリ：React Native または Flutter

### 9.3 運用前提
- サーバー監視体制
- バックアップの自動実施
- セキュリティパッチの定期適用
- ユーザーサポート体制

## 10. その他

### 10.1 段階的実装
- Phase 1：基本機能（ユーザー登録、貸し借り管理、返済記録）
- Phase 2：通知・リマインダー、友達管理
- Phase 3：グループ精算機能
- Phase 4：統計・レポート、証明書発行
- Phase 5：決済サービス連携、AI機能

### 10.2 今後の拡張案
- AI による返済傾向分析・予測
- ボイスアシスタント連携（Alexa、Google Assistant）
- ブロックチェーン技術による改ざん防止
- 仮想通貨対応
- マルチ通貨対応（海外送金）
- 銀行口座連携による自動返済
- 信用スコアリング機能
- コミュニティ機能（体験談、アドバイス共有）

### 10.3 課題・リスク
- 金銭トラブルへの対応（サポート体制の強化）
- 不正利用の防止（高額取引の監視、利用規約の明確化）
- プライバシー保護（個人情報の厳重管理）
- 法令遵守（貸金業法等への抵触回避）
- ユーザー教育（適切な利用方法の啓蒙）

### 10.4 免責事項
- 本システムは個人間の金銭管理を補助するツールであり、法的効力を保証するものではありません
- 貸し借りに関するトラブルについて、本システムの運営者は一切の責任を負いません
- 高額な金銭の貸し借りや正式な契約が必要な場合は、専門家にご相談ください
- 本システムの利用により生じたいかなる損害についても、運営者は責任を負いません
